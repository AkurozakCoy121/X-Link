<!DOCTYPE html>
<html>
<head>
<title>Redirecting... | NexeID</title>
<meta http-equiv="refresh" content="5; url=about:blank">
<script>
// Get URL from parameter - handle multiple encoding
function getUrlParam() {
    var params = new URLSearchParams(window.location.search);
    var url = params.get('to');
    
    // Try to decode multiple times if needed
    while (url && url.includes('%')) {
        try {
            var decoded = decodeURIComponent(url);
            if (decoded === url) break; // No more encoding
            url = decoded;
        } catch {
            break; // Stop if error
        }
    }
    
    return url;
}

var url = getUrlParam();

if (url) {
    // Validate URL
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
    }
    
    // Update meta refresh
    document.querySelector('meta[http-equiv="refresh"]').content = '5; url=' + encodeURI(url);
    
    // Show destination
    document.getElementById('dest').innerText = url.length > 50 ? url.substring(0, 50) + '...' : url;
    document.getElementById('dest').href = url;
    document.getElementById('manual').href = url;
    
    // Start countdown
    var count = 5;
    var cd = document.getElementById('count');
    var int = setInterval(function() {
        count--;
        cd.innerText = count;
        if (count <= 0) {
            clearInterval(int);
            window.location.href = url;
        }
    }, 1000);
} else {
    document.body.innerHTML = '<center><h1>❌ Error</h1><p>Missing or invalid URL parameter</p><p>Usage: <code>/r.html?to=https://example.com</code></p><a href="/">Go Home</a></center>';
}
</script>
</head>
<body>
<center>

<h1>↪️ NexeID Redirect</h1>
<p>You are being redirected...</p>

<h2 id="count">5</h2>
<p>seconds remaining</p>

<hr width="300">

<h3>Advertisement:</h3>
<p><b>This redirect powered by NexeID</b></p>
<p>Create your own free redirects at <a href="https://nexeid.my.id">nexeid.my.id</a></p>

<hr width="300">

<p>Destination: <a id="dest" href="#">(loading...)</a></p>
<p><a id="manual" href="#">Click here if not redirected</a></p>

<hr width="300">

<p><small>nexeid.my.id • Free service • No tracking</small></p>

</center>
</body>
</html>
